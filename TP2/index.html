
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../TP1/">
      
      
        <link rel="next" href="../TP3/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Gestion de la politique SELinux - SELinux</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%209.5A2.5%202.5%200%200%200%209.5%2012a2.5%202.5%200%200%200%202.5%202.5%202.5%202.5%200%200%200%202.5-2.5A2.5%202.5%200%200%200%2012%209.5m0%203.5a1%201%200%200%201-1-1%201%201%200%200%201%201-1%201%201%200%200%201%201%201%201%201%200%200%201-1%201m0-3.5A2.5%202.5%200%200%200%209.5%2012a2.5%202.5%200%200%200%202.5%202.5%202.5%202.5%200%200%200%202.5-2.5A2.5%202.5%200%200%200%2012%209.5m0%203.5a1%201%200%200%201-1-1%201%201%200%200%201%201-1%201%201%200%200%201%201%201%201%201%200%200%201-1%201m0-11A10%2010%200%200%200%202%2012a10%2010%200%200%200%2010%2010%2010%2010%200%200%200%2010-10A10%2010%200%200%200%2012%202m0%2014c-2.63%200-5-1.57-6-4a6.505%206.505%200%200%201%208.5-3.5A6.52%206.52%200%200%201%2018%2012c-1%202.43-3.37%204-6%204m0-6.5A2.5%202.5%200%200%200%209.5%2012a2.5%202.5%200%200%200%202.5%202.5%202.5%202.5%200%200%200%202.5-2.5A2.5%202.5%200%200%200%2012%209.5m0%203.5a1%201%200%200%201-1-1%201%201%200%200%201%201-1%201%201%200%200%201%201%201%201%201%200%200%201-1%201%22/%3E%3C/svg%3E');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Gestion de la politique SELinux - SELinux" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="./assets/images/social/TP2.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="None" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Gestion de la politique SELinux - SELinux" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="./assets/images/social/TP2.png" >
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#apache-httpd-et-restauration-des-contextes" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href=".." title="SELinux" class="md-header__button md-logo" aria-label="SELinux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SELinux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gestion de la politique SELinux
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SELinux" class="md-nav__button md-logo" aria-label="SELinux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    SELinux
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Programme
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TP1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction et troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Gestion de la politique SELinux
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Gestion de la politique SELinux
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#apache-httpd-et-restauration-des-contextes" class="md-nav__link">
    <span class="md-ellipsis">
      Apache HTTPD et restauration des contextes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Apache HTTPD et restauration des contextes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objectif" class="md-nav__link">
    <span class="md-ellipsis">
      Objectif
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etapes" class="md-nav__link">
    <span class="md-ellipsis">
      Étapes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Étapes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-dapache" class="md-nav__link">
    <span class="md-ellipsis">
      Installation d'Apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creer-un-dossier-personnalise" class="md-nav__link">
    <span class="md-ellipsis">
      Créer un dossier personnalisé
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correction" class="md-nav__link">
    <span class="md-ellipsis">
      Correction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilisation-des-booleens-selinux" class="md-nav__link">
    <span class="md-ellipsis">
      Utilisation des booléens SELinux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilisation des booléens SELinux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objectif_1" class="md-nav__link">
    <span class="md-ellipsis">
      Objectif
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etapes_1" class="md-nav__link">
    <span class="md-ellipsis">
      Étapes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Étapes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#faire-en-sorte-quapache-se-connecte-au-reseau" class="md-nav__link">
    <span class="md-ellipsis">
      Faire en sorte qu'Apache se connecte au réseau
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correction-du-probleme-selinux" class="md-nav__link">
    <span class="md-ellipsis">
      Correction du problème SELinux
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TP3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Création de module custom
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TP4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MLS/MCS
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TP5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SELinux et conteneurs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SELinux cheatsheet
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#apache-httpd-et-restauration-des-contextes" class="md-nav__link">
    <span class="md-ellipsis">
      Apache HTTPD et restauration des contextes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Apache HTTPD et restauration des contextes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objectif" class="md-nav__link">
    <span class="md-ellipsis">
      Objectif
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etapes" class="md-nav__link">
    <span class="md-ellipsis">
      Étapes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Étapes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-dapache" class="md-nav__link">
    <span class="md-ellipsis">
      Installation d'Apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creer-un-dossier-personnalise" class="md-nav__link">
    <span class="md-ellipsis">
      Créer un dossier personnalisé
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correction" class="md-nav__link">
    <span class="md-ellipsis">
      Correction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilisation-des-booleens-selinux" class="md-nav__link">
    <span class="md-ellipsis">
      Utilisation des booléens SELinux
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilisation des booléens SELinux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objectif_1" class="md-nav__link">
    <span class="md-ellipsis">
      Objectif
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etapes_1" class="md-nav__link">
    <span class="md-ellipsis">
      Étapes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Étapes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#faire-en-sorte-quapache-se-connecte-au-reseau" class="md-nav__link">
    <span class="md-ellipsis">
      Faire en sorte qu'Apache se connecte au réseau
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correction-du-probleme-selinux" class="md-nav__link">
    <span class="md-ellipsis">
      Correction du problème SELinux
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Gestion de la politique SELinux</h1>

<h2 id="apache-httpd-et-restauration-des-contextes">Apache HTTPD et restauration des contextes</h2>
<h3 id="objectif">Objectif</h3>
<p>Corriger un blocage SELinux causé par un mauvais contexte sur un répertoire personnalisé utilisé par Apache.</p>
<h3 id="etapes">Étapes</h3>
<h4 id="installation-dapache">Installation d'Apache</h4>
<p>Installez Apache et accéder à un petit fichier depuis un navigateur internet.</p>
<details class="note">
<summary>Solution</summary>
<p>Installation d'apache et création d'un index.html
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>httpd
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>httpd
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Coucou&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/var/www/html/index.html
</span></code></pre></div></td></tr></table></div>
Ouverture dans le firewall !
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>http<span class="w"> </span>--permanent
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a>firewall-cmd<span class="w"> </span>--reload
</span></code></pre></div></td></tr></table></div></p>
</details>
<h4 id="creer-un-dossier-personnalise">Créer un dossier personnalisé</h4>
<p>Mettez les fichiers du serveur web dans un dossier personnalisé ce qui entrainera un blocage.</p>
<details class="note">
<summary>Solution</summary>
<p>Création d'un dossier avec un fichier index.html</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>mkdir<span class="w"> </span>/webdata
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Coucou&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/webdata/index.html
</span></code></pre></div></td></tr></table></div>
<p>Modifier la configuration Apache</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a>cp<span class="w"> </span>/etc/httpd/conf/httpd.conf<span class="w"> </span>/tmp/httpd.conf.old
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s|/var/www/html|/webdata|g&#39;</span><span class="w"> </span>/etc/httpd/conf/httpd.conf
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s|IncludeOptional|#IncludeOptional|g&#39;</span><span class="w"> </span>/etc/httpd/conf/httpd.conf
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>httpd
</span></code></pre></div></td></tr></table></div>
</details>
<p>Accédez à <code>http://{ip-serveur}</code> et notez l'erreur provoquée par SELinux.</p>
<h4 id="correction">Correction</h4>
<p>Analysez et corrigez le problème de manière permanente avec semanage.</p>
<details class="note">
<summary>Solution</summary>
<p><div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a>ls<span class="w"> </span>-Zd<span class="w"> </span>/webdata
</span></code></pre></div></td></tr></table></div>
Le contexte de <code>/webdata</code> est <code>default_t</code>, ce qui empêche surement Apache d'accéder aux fichiers.</p>
<p>Utilisons <code>sealert</code> pour voir l'erreur :</p>
<p><div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a>sealert<span class="w">  </span>-a<span class="w"> </span>/var/log/audit/audit.log
</span></code></pre></div></td></tr></table></div>
<code>sealert</code> nous dit de changer le contexte par défaut et nous donnne une longue liste peu pertinente puis nous dit de faire un <code>restorecon</code>.</p>
<p>On détermine de manière plus précise le bon type en regardant les types liés à <code>httpd</code> mais aussi plus simplement le type des fichiers par défaut de <code>/var/www/html</code>.</p>
<p><div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a>seinfo<span class="w"> </span>-t<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>httpd<span class="w"> </span><span class="c1"># On peut voir des types liés au &quot;content&quot;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a>ls<span class="w"> </span>-lZ<span class="w"> </span>/var/www/html/<span class="w"> </span><span class="c1"># Le type de base est httpd_sys_content_t </span>
</span></code></pre></div></td></tr></table></div>
Correction : </p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># On mets une regex simple pour tout les fichiers dans /webdata</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>semanage<span class="w"> </span>fcontext<span class="w"> </span>-a<span class="w"> </span>-t<span class="w"> </span>httpd_sys_content_t<span class="w"> </span><span class="s2">&quot;/webdata(/.*)?&quot;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a>restorecon<span class="w"> </span>-Rv<span class="w"> </span>/webdata
</span></code></pre></div></td></tr></table></div>
<p>Rechargez la page web. L'accès doit maintenant être fonctionnel.</p>
</details>
<hr />
<h2 id="utilisation-des-booleens-selinux">Utilisation des booléens SELinux</h2>
<h3 id="objectif_1">Objectif</h3>
<p>Activer un booléen SELinux pour permettre une fonctionnalité bloquée par défaut (ex. shell restreint via SSH).</p>
<h3 id="etapes_1">Étapes</h3>
<h4 id="faire-en-sorte-quapache-se-connecte-au-reseau">Faire en sorte qu'Apache se connecte au réseau</h4>
<p>Faites un script dans <code>/var/www/cgi-bin/</code> qui sera atteignable sur le serveur web, exécuté par <code>httpd</code> et récupère des infos sur d'autres site web du net.</p>
<p>L'url sera sur http://{ip-serveur}/cgi-bin/testnet.sh, mais elle ne devrait pas fonctionner directement.</p>
<details class="note">
<summary>Solution</summary>
<p>Commençons par remettre à zéro notre configuration httpd :</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a>cp<span class="w"> </span>/tmp/httpd.conf.old<span class="w"> </span>/etc/httpd/conf/httpd.conf
</span></code></pre></div></td></tr></table></div>
<p>Le script: </p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span>
<span class="normal"><a href="#__codelineno-9-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/www/cgi-bin
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>/var/www/cgi-bin/testnet.sh<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="s">#!/bin/bash</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="s">echo &quot;Content-type: http&quot;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="s">echo &quot;&quot;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="s">curl -s https://channels.nixos.org</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="s">EOF</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a>chmod<span class="w"> </span>+x<span class="w"> </span>/var/www/cgi-bin/testnet.sh
</span></code></pre></div></td></tr></table></div>
<p>Rajoutez dans la conf httpd : </p>
<div class="language-html highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a>ScriptAlias /cgi-bin/ /var/www/cgi-bin/
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="p">&lt;</span><span class="nt">Directory</span> <span class="err">&quot;/</span><span class="na">var</span><span class="err">/</span><span class="na">www</span><span class="err">/</span><span class="na">cgi-bin</span><span class="err">&quot;</span><span class="p">&gt;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a>    AllowOverride None
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a>    Options +ExecCGI
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a>    Require all granted
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="p">&lt;/</span><span class="nt">Directory</span><span class="p">&gt;</span>
</span></code></pre></div></td></tr></table></div>
<p>Puis redémarrez <code>httpd</code> avec <code>systemctl restart httpd</code></p>
</details>
<h4 id="correction-du-probleme-selinux">Correction du problème SELinux</h4>
<p>Observez le blocage SELinux et corrigez via un booléen </p>
<details class="note">
<summary>Solution</summary>
<p><div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a>sealert<span class="w"> </span>-a<span class="w"> </span>/var/log/audit/audit.log
</span></code></pre></div></td></tr></table></div>
<code>sealert</code> nous suggère pour notre erreur 3 solution avec divers scores de confiance.
La première nous demande si on veut que "htppd can network connect", ce qui est bien notre cas. La solution est suggérée est d'activer un booléen et la commande est fournie.</p>
<p><div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a>setsebool<span class="w"> </span>-P<span class="w"> </span>httpd_can_network_connect<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># active le booléen de manière permanente</span>
</span></code></pre></div></td></tr></table></div>
Le site devrait maintenant être accessible.</p>
</details>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Retour en haut de la page
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.action.edit", "search.highlight", "search.suggest", "navigation.top", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>