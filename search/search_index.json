{"config":{"lang":["fr"],"separator":"[\\s\\-\\.]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Cours SELinux","text":""},{"location":"TP1/","title":"TP : Introduction \u00e0 SELinux et Analyse des blocages","text":""},{"location":"TP1/#objectifs","title":"Objectifs","text":"<ul> <li>Comprendre le fonctionnement g\u00e9n\u00e9ral de SELinux</li> <li>Identifier et interpr\u00e9ter les contextes SELinux</li> <li>Manipuler les outils de diagnostic des blocages (AVC)</li> <li>R\u00e9soudre des probl\u00e8mes classiques li\u00e9s \u00e0 la politique de s\u00e9curit\u00e9</li> </ul>"},{"location":"TP1/#prerequis","title":"Pr\u00e9requis","text":"<ul> <li>VM Fedora Server avec SELinux activ\u00e9 (<code>getenforce</code> renvoie <code>Enforcing</code>)</li> <li>Acc\u00e8s root ou via <code>sudo</code></li> <li>Paquets utiles install\u00e9s : <code>policycoreutils</code>, <code>policycoreutils-python-utils</code>, <code>setroubleshoot</code>, <code>audit</code>, <code>selinux-policy-devel</code></li> </ul>"},{"location":"TP1/#partie-1-decouverte-et-etat-de-selinux","title":"Partie 1 : D\u00e9couverte et \u00e9tat de SELinux","text":""},{"location":"TP1/#1-verification-de-letat-selinux","title":"1. V\u00e9rification de l\u2019\u00e9tat SELinux","text":"<pre><code>getenforce\nsestatus\nselinuxenabled &amp;&amp; echo \"SELinux est activ\u00e9\"\n</code></pre> <p>Observez le mode (<code>Enforcing</code>, <code>Permissive</code>, <code>Disabled</code>) et la politique en cours (<code>targeted</code>, <code>mls</code>, etc.)</p>"},{"location":"TP1/#2-observation-des-contextes","title":"2. Observation des contextes","text":"<pre><code>ls -Z /\nps -eZ | grep sshd\nid -Z\n</code></pre> <p>Notez la forme du contexte : <code>user:role:type:level</code>. Essayez de rep\u00e9rer les parties utiles.</p>"},{"location":"TP1/#partie-2-mise-en-evidence-dun-blocage-selinux","title":"Partie 2 : Mise en \u00e9vidence d\u2019un blocage SELinux","text":""},{"location":"TP1/#3-mise-en-place-dun-blocage-selinux-volontaire","title":"3. Mise en place d\u2019un blocage SELinux volontaire","text":"<pre><code>mkdir /srv/testselinux\ncp /bin/bash /srv/testselinux/bash\nchmod +x /srv/testselinux/bash\n/srv/testselinux/bash\n</code></pre> <p>Le binaire <code>bash</code> copi\u00e9 perd son label habituel. SELinux devrait bloquer son ex\u00e9cution. Que se passe-t-il ? Testez avec <code>getenforce permissive</code> pour comparer.</p>"},{"location":"TP1/#partie-3-analyse-des-messages-avc","title":"Partie 3 : Analyse des messages AVC","text":""},{"location":"TP1/#4-lecture-brute-des-logs","title":"4. Lecture brute des logs","text":"<pre><code>ausearch -m AVC -ts recent\n</code></pre> <p>Identifiez la source, la cible, et l\u2019action interdite.</p>"},{"location":"TP1/#5-utilisation-des-outils-de-diagnostic","title":"5. Utilisation des outils de diagnostic","text":"<pre><code>audit2why &lt; /var/log/audit/audit.log\naudit2allow -w -a\naudit2allow -a\n</code></pre> <p>Que propose <code>audit2allow</code> ? Est-ce acceptable en production ?</p>"},{"location":"TP1/#6-interface-plus-simple-sealert","title":"6. Interface plus simple : sealert","text":"<pre><code>sealert -a /var/log/audit/audit.log\n</code></pre> <p>Essayez de lire les suggestions de r\u00e9solution. V\u00e9rifiez que le service <code>setroubleshootd</code> est actif si la commande ne retourne rien.</p>"},{"location":"TP1/#partie-4-correction-du-probleme","title":"Partie 4 : Correction du probl\u00e8me","text":""},{"location":"TP1/#7-restauration-des-bons-contextes","title":"7. Restauration des bons contextes","text":"<pre><code>restorecon -Rv /srv/testselinux\n</code></pre> <p>Relancez le binaire ensuite. Est-ce que \u00e7a fonctionne ? V\u00e9rifiez \u00e0 nouveau les contextes (<code>ls -Z</code>).</p>"},{"location":"TP1/#bonus-test-en-mode-permissif","title":"Bonus : test en mode permissif","text":"<pre><code>setenforce 0\n</code></pre> <ul> <li>Rejouez l\u2019ex\u00e9cution du binaire copi\u00e9</li> <li>Observez le comportement</li> <li>V\u00e9rifiez que les messages AVC apparaissent quand m\u00eame</li> </ul>"},{"location":"TP1/#a-la-fin-du-tp-vous-devez-savoir","title":"\u00c0 la fin du TP, vous devez savoir :","text":"<ul> <li>Lire et comprendre un contexte SELinux</li> <li>D\u00e9tecter les erreurs AVC dans les logs</li> <li>Utiliser les outils de diagnostic</li> <li>Corriger un probl\u00e8me classique d\u2019\u00e9tiquetage (<code>restorecon</code>)</li> </ul>"},{"location":"TP2/","title":"Apache HTTPD et restauration des contextes","text":""},{"location":"TP2/#objectif","title":"Objectif","text":"<p>Corriger un blocage SELinux caus\u00e9 par un mauvais contexte sur un r\u00e9pertoire personnalis\u00e9 utilis\u00e9 par Apache.</p>"},{"location":"TP2/#etapes","title":"\u00c9tapes","text":""},{"location":"TP2/#installer-apache","title":"Installer Apache","text":"<pre><code>sudo dnf install -y httpd\nsudo systemctl enable --now httpd\n</code></pre>"},{"location":"TP2/#creer-un-dossier-personnalise","title":"Cr\u00e9er un dossier personnalis\u00e9","text":"<pre><code>sudo mkdir /webdata\necho \"SELinux TP\" | sudo tee /webdata/index.html\nsudo chmod -R 755 /webdata\n</code></pre>"},{"location":"TP2/#modifier-la-configuration-apache","title":"Modifier la configuration Apache","text":"<pre><code>sudo cp /etc/httpd/conf.d/welcome.conf /etc/httpd/conf.d/tp.conf\nsudo sed -i 's|/var/www/html|/webdata|' /etc/httpd/conf.d/tp.conf\nsudo systemctl restart httpd\n</code></pre> <p>Acc\u00e9dez \u00e0 <code>http://localhost</code> et notez l'erreur 403 provoqu\u00e9e par SELinux.</p>"},{"location":"TP2/#verifier-le-contexte-selinux","title":"V\u00e9rifier le contexte SELinux","text":"<pre><code>ls -Zd /webdata\n</code></pre> <p>Le contexte est incorrect (<code>default_t</code>), ce qui emp\u00eache Apache d'acc\u00e9der aux fichiers.</p>"},{"location":"TP2/#corriger-avec-semanage-et-restorecon","title":"Corriger avec <code>semanage</code> et <code>restorecon</code>","text":"<pre><code>sudo semanage fcontext -a -t httpd_sys_content_t \"/webdata(/.*)?\"\nsudo restorecon -Rv /webdata\n</code></pre> <p>Rechargez la page web. L'acc\u00e8s doit maintenant \u00eatre fonctionnel.</p>"},{"location":"TP2/#utilisation-des-booleens-selinux-avec-ssh","title":"Utilisation des bool\u00e9ens SELinux avec SSH","text":""},{"location":"TP2/#objectif_1","title":"Objectif","text":"<p>Activer un bool\u00e9en SELinux pour permettre une fonctionnalit\u00e9 bloqu\u00e9e par d\u00e9faut (ex. shell restreint via SSH).</p>"},{"location":"TP2/#etapes_1","title":"\u00c9tapes","text":""},{"location":"TP2/#installer-et-configurer-un-shell-restreint","title":"Installer et configurer un shell restreint","text":"<pre><code>sudo dnf install -y rssh\n</code></pre> <p>Cr\u00e9er un utilisateur d\u00e9di\u00e9 :</p> <pre><code>sudo useradd -m -s /usr/bin/rssh rsshuser\nsudo passwd rsshuser\n</code></pre>"},{"location":"TP2/#tester-la-connexion-ssh","title":"Tester la connexion SSH","text":"<p>Tentative de connexion via SSH. \u00c9chec attendu d\u00fb \u00e0 une restriction SELinux.</p>"},{"location":"TP2/#diagnostiquer-le-blocage","title":"Diagnostiquer le blocage","text":"<pre><code>sudo ausearch -m AVC -ts recent\nsudo audit2why -a\n</code></pre> <p>Identifier la recommandation et v\u00e9rifier les bool\u00e9ens associ\u00e9s :</p> <pre><code>getsebool -a | grep ssh\n</code></pre>"},{"location":"TP2/#appliquer-la-modification","title":"Appliquer la modification","text":"<pre><code>sudo setsebool -P allowssh_chroot_full_access on\n</code></pre> <p>Tester \u00e0 nouveau la connexion SSH.</p>"},{"location":"TP2/#manipulation-directe-des-contextes-avec-chcon","title":"Manipulation directe des contextes avec <code>chcon</code>","text":""},{"location":"TP2/#objectif_2","title":"Objectif","text":"<p>Modifier temporairement un contexte SELinux sans toucher aux r\u00e8gles persistantes, pour un cas de test ou d\u00e9bogage.</p>"},{"location":"TP2/#etapes_2","title":"\u00c9tapes","text":""},{"location":"TP2/#creer-un-fichier-de-test","title":"Cr\u00e9er un fichier de test","text":"<pre><code>mkdir ~/testselinux\ntouch ~/testselinux/file.txt\nls -Z ~/testselinux/file.txt\n</code></pre>"},{"location":"TP2/#changer-le-contexte","title":"Changer le contexte","text":"<pre><code>sudo chcon -t httpd_sys_content_t ~/testselinux/file.txt\nls -Z ~/testselinux/file.txt\n</code></pre>"},{"location":"TP2/#lancer-un-serveur-http-local","title":"Lancer un serveur HTTP local","text":"<pre><code>python3 -m http.server --directory ~/testselinux 8080\n</code></pre> <p>Acc\u00e9der \u00e0 <code>http://localhost:8080/file.txt</code>. SELinux ne devrait pas bloquer si le contexte est correctement appliqu\u00e9.</p>"},{"location":"TP2/#reinitialiser-le-contexte","title":"R\u00e9initialiser le contexte","text":"<pre><code>sudo restorecon -v ~/testselinux/file.txt\n</code></pre> <p>V\u00e9rifier que le contexte d\u2019origine a \u00e9t\u00e9 restaur\u00e9.</p>"}]}