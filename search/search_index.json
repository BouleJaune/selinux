{"config":{"lang":["fr"],"separator":"[\\s\\-\\.]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Cours SELinux","text":""},{"location":"TP1/","title":"TP : Introduction \u00e0 SELinux et Analyse des blocages","text":""},{"location":"TP1/#objectifs","title":"Objectifs","text":"<ul> <li>Comprendre le fonctionnement g\u00e9n\u00e9ral de SELinux</li> <li>Identifier et interpr\u00e9ter les contextes SELinux</li> <li>Manipuler les outils de diagnostic des blocages (AVC)</li> <li>R\u00e9soudre des probl\u00e8mes classiques li\u00e9s \u00e0 la politique de s\u00e9curit\u00e9</li> </ul>"},{"location":"TP1/#prerequis","title":"Pr\u00e9requis","text":"<ul> <li>VM Fedora Server avec SELinux</li> <li>Acc\u00e8s root</li> <li>Paquets utiles install\u00e9s : <code>policycoreutils</code>, <code>policycoreutils-python-utils</code>, <code>setroubleshoot</code>, <code>audit</code>, <code>selinux-policy-devel</code></li> </ul>"},{"location":"TP1/#decouverte-et-etat-de-selinux","title":"D\u00e9couverte et \u00e9tat de SELinux","text":""},{"location":"TP1/#verification-de-letat-selinux","title":"V\u00e9rification de l\u2019\u00e9tat SELinux","text":"<p>Utilisez des commandes CLI pour voir l'\u00e9tat de SELinux et voir quelle elle la policy actuellement charg\u00e9e.</p> <p>Vous pouvez aussi utiliser une commande renvoyant un code de retour 1 ou 0 pour voir l'\u00e9tat de SELinux, utile dans les scripts.</p> Commandes <pre><code>getenforce\nsestatus\nselinuxenabled &amp;&amp; echo \"SELinux est activ\u00e9\"\n</code></pre>"},{"location":"TP1/#observation-des-contextes","title":"Observation des contextes","text":"<p>Lister les contextes de : fichiers, processes, ports, utilisateur...</p> Commandes <pre><code>ls -Z /\nps -eZ \nsemanage port -l\nid -Z\n</code></pre>"},{"location":"TP1/#mise-en-evidence-dun-blocage-selinux","title":"Mise en \u00e9vidence d\u2019un blocage SELinux","text":""},{"location":"TP1/#mise-en-place-dun-blocage-selinux-volontaire","title":"Mise en place d\u2019un blocage SELinux volontaire","text":"<p>Faites en sorte d'utiliser le binaire <code>bash</code> de mani\u00e8re non-standard, par exemple en le copiant, pour g\u00e9n\u00e9rer un blocage. Passez ensuite en <code>permissive</code> pour la suite et bien voir que c'est SELinux qui bloque.</p> Commandes <pre><code>mkdir /srv/testselinux\ncp /bin/bash /srv/testselinux/bash\nchmod +x /srv/testselinux/bash\n/srv/testselinux/bash\n</code></pre>"},{"location":"TP1/#analyse-des-messages-avc","title":"Analyse des messages AVC","text":""},{"location":"TP1/#lecture-brute-des-logs","title":"Lecture brute des logs","text":"<p>Retrouvez ces blocages dans les logs du syst\u00e8me de diff\u00e9rentes mani\u00e8res et identifiez la source, cible et action interdite.</p> <p>[TODO] ajout d'autres m\u00e9thodes de logs</p> Commandes <pre><code>ausearch -m AVC -ts recent\n</code></pre>"},{"location":"TP1/#utilisation-des-outils-de-diagnostic","title":"Utilisation des outils de diagnostic","text":"<p>Que propose <code>audit2allow</code> et <code>audit2why</code> ? Est-ce acceptable en production ?</p> Commandes <pre><code>audit2why &lt; /var/log/audit/audit.log\naudit2allow -w -a\naudit2allow -a\n</code></pre>"},{"location":"TP1/#interface-plus-simple-sealert","title":"Interface plus simple : sealert","text":"<p>Essayez de lire les suggestions de r\u00e9solution. V\u00e9rifiez que le service <code>setroubleshootd</code> est actif si la commande ne retourne rien.</p> Commandes <pre><code>sealert -a /var/log/audit/audit.log\n</code></pre>"},{"location":"TP1/#correction-du-probleme","title":"Correction du probl\u00e8me","text":""},{"location":"TP1/#restauration-des-bons-contextes","title":"Restauration des bons contextes","text":"Commandes <pre><code>restorecon -Rv /srv/testselinux\n</code></pre> <p>Relancez le binaire ensuite. Est-ce que \u00e7a fonctionne ? V\u00e9rifiez \u00e0 nouveau les contextes (<code>ls -Z</code>).</p>"},{"location":"TP1/#a-la-fin-du-tp-vous-devez-savoir","title":"\u00c0 la fin du TP, vous devez savoir :","text":"<ul> <li>Lire et comprendre un contexte SELinux</li> <li>D\u00e9tecter les erreurs AVC dans les logs</li> <li>Utiliser les outils de diagnostic</li> <li>Corriger un probl\u00e8me classique d\u2019\u00e9tiquetage (<code>restorecon</code>)</li> </ul>"},{"location":"TP1/#tp-flask-partie-1","title":"TP Flask \u2014 Partie 1","text":""},{"location":"TP1/#introduction-a-selinux-diagnostic-des-blocages","title":"Introduction \u00e0 SELinux &amp; Diagnostic des blocages","text":""},{"location":"TP1/#contexte","title":"Contexte","text":"<p>Vous \u00eates d\u00e9veloppeur d'une application Python nomm\u00e9e <code>fileserve</code>, d\u00e9velopp\u00e9e avec Flask. Elle permet :</p> <ul> <li>de lire des fichiers depuis un r\u00e9pertoire <code>/data/public</code></li> <li>d\u2019\u00e9crire des logs dans <code>/var/log/fileserve.log</code></li> <li>de servir tout cela sur le port 8080</li> </ul> <p>Elle n\u2019est pas encore conteneuris\u00e9e : vous l'ex\u00e9cuterez directement sur votre Fedora en tant que service utilisateur.</p>"},{"location":"TP1/#objectifs_1","title":"Objectifs","text":"<ul> <li>Explorer le contexte SELinux de votre syst\u00e8me</li> <li>Observer et comprendre les blocages li\u00e9s \u00e0 SELinux</li> <li>Diagnostiquer \u00e0 l\u2019aide des outils fournis</li> <li>Appliquer les premi\u00e8res manipulations correctives</li> </ul>"},{"location":"TP1/#prerequis-techniques","title":"Pr\u00e9requis techniques","text":"<ul> <li>L'application Python (fournie par l'instructeur ou cod\u00e9e simple)</li> <li> <p>R\u00e9pertoires :</p> </li> <li> <p><code>/data/public/</code> (contenant des fichiers)</p> </li> <li><code>/var/log/fileserve.log</code></li> </ul>"},{"location":"TP1/#etapes","title":"\u00c9tapes","text":""},{"location":"TP1/#decouverte-de-lappli","title":"D\u00e9couverte de l'appli","text":"<ul> <li>Identifier le mode actif de SELinux (<code>getenforce</code>, <code>sestatus</code>)</li> <li>V\u00e9rifier que SELinux est activ\u00e9 au boot</li> <li> <p>Observer les contextes :</p> </li> <li> <p>de fichiers (<code>ls -Z /data/public</code>)</p> </li> <li>de processus (<code>ps -eZ | grep flask</code>)</li> <li>de ports (<code>semanage port -l | grep 8080</code>)</li> <li>de sockets (<code>ss -Ztulpen</code>)</li> </ul>"},{"location":"TP1/#premiers-blocages","title":"Premiers blocages","text":"<ul> <li> <p>Lancer le script Python avec <code>python3 app.py</code></p> </li> <li> <p>Tenter d\u2019acc\u00e9der aux fichiers via navigateur ou curl</p> </li> <li> <p>Observer les messages d\u2019erreur dans :</p> </li> <li> <p>le navigateur / terminal</p> </li> <li> <p>les logs journaux</p> </li> <li> <p>Analyser les logs SELinux :</p> </li> <li> <p><code>journalctl -t setroubleshoot</code></p> </li> <li><code>journalctl | grep AVC</code></li> <li><code>ausearch -m avc -ts recent</code></li> <li><code>audit2why</code> avec le r\u00e9sultat</li> </ul>"},{"location":"TP1/#actions-correctives","title":"Actions correctives","text":"<ul> <li>Identifier si un label est incorrect (<code>ls -Z</code>)</li> <li> <p>Corriger avec :</p> </li> <li> <p><code>chcon</code></p> </li> <li><code>restorecon</code></li> <li>Comparer les effets des 2</li> <li>V\u00e9rifier les autorisations sur le port 8080 (<code>semanage port</code>)</li> </ul>"},{"location":"TP1/#exploration-pratique","title":"Exploration pratique","text":"<ul> <li>Modifier le script pour \u00e9crire dans <code>/tmp</code>, observer le comportement</li> <li>Remonter en permissive, relancer (<code>setenforce 0</code>), puis <code>audit2allow</code> pour proposer une r\u00e8gle</li> <li>Revenir en enforcing, appliquer <code>audit2allow</code> en module temporaire (<code>checkmodule</code>, <code>semodule_package</code>, <code>semodule -i</code>)</li> </ul>"},{"location":"TP1/#a-livrer-presenter","title":"\u00c0 livrer / Pr\u00e9senter","text":"<ul> <li>Contexte des objets manipul\u00e9s</li> <li>Journal AVC annot\u00e9</li> <li>Une hypoth\u00e8se de r\u00e8gle n\u00e9cessaire</li> <li>L\u2019\u00e9tat des contextes avant/apr\u00e8s</li> <li>Un court rapport sur ce qu\u2019a bloqu\u00e9 SELinux, et pourquoi</li> </ul>"},{"location":"TP1/#astuce-pour-linstructeur","title":"Astuce pour l\u2019instructeur","text":"<p>Tu peux faire injecter un bug volontaire (ex. mauvais port, label incorrect sur <code>/data/public</code>) pour forcer les messages AVC. Option bonus : ajouter un second script qui lit <code>/etc/shadow</code> pour g\u00e9n\u00e9rer un AVC \u00ab critique \u00bb.</p> <p>Souhaites-tu une version formatt\u00e9e \u00e9l\u00e8ve avec placeholders et sections \u00e0 remplir, ou tu pr\u00e9f\u00e8res ce style pour t\u2019adapter en live ?</p>"},{"location":"TP2/","title":"Apache HTTPD et restauration des contextes","text":""},{"location":"TP2/#objectif","title":"Objectif","text":"<p>Corriger un blocage SELinux caus\u00e9 par un mauvais contexte sur un r\u00e9pertoire personnalis\u00e9 utilis\u00e9 par Apache.</p>"},{"location":"TP2/#etapes","title":"\u00c9tapes","text":""},{"location":"TP2/#installer-apache","title":"Installer Apache","text":"<pre><code>sudo dnf install -y httpd\nsudo systemctl enable --now httpd\n</code></pre>"},{"location":"TP2/#creer-un-dossier-personnalise","title":"Cr\u00e9er un dossier personnalis\u00e9","text":"<pre><code>sudo mkdir /webdata\necho \"SELinux TP\" | sudo tee /webdata/index.html\nsudo chmod -R 755 /webdata\n</code></pre>"},{"location":"TP2/#modifier-la-configuration-apache","title":"Modifier la configuration Apache","text":"<pre><code>sudo cp /etc/httpd/conf.d/welcome.conf /etc/httpd/conf.d/tp.conf\nsudo sed -i 's|/var/www/html|/webdata|' /etc/httpd/conf.d/tp.conf\nsudo systemctl restart httpd\n</code></pre> <p>Acc\u00e9dez \u00e0 <code>http://localhost</code> et notez l'erreur 403 provoqu\u00e9e par SELinux.</p>"},{"location":"TP2/#verifier-le-contexte-selinux","title":"V\u00e9rifier le contexte SELinux","text":"<pre><code>ls -Zd /webdata\n</code></pre> <p>Le contexte est incorrect (<code>default_t</code>), ce qui emp\u00eache Apache d'acc\u00e9der aux fichiers.</p>"},{"location":"TP2/#corriger-avec-semanage-et-restorecon","title":"Corriger avec <code>semanage</code> et <code>restorecon</code>","text":"<pre><code>sudo semanage fcontext -a -t httpd_sys_content_t \"/webdata(/.*)?\"\nsudo restorecon -Rv /webdata\n</code></pre> <p>Rechargez la page web. L'acc\u00e8s doit maintenant \u00eatre fonctionnel.</p>"},{"location":"TP2/#utilisation-des-booleens-selinux-avec-ssh","title":"Utilisation des bool\u00e9ens SELinux avec SSH","text":""},{"location":"TP2/#objectif_1","title":"Objectif","text":"<p>Activer un bool\u00e9en SELinux pour permettre une fonctionnalit\u00e9 bloqu\u00e9e par d\u00e9faut (ex. shell restreint via SSH).</p>"},{"location":"TP2/#etapes_1","title":"\u00c9tapes","text":""},{"location":"TP2/#installer-et-configurer-un-shell-restreint","title":"Installer et configurer un shell restreint","text":"<pre><code>sudo dnf install -y rssh\n</code></pre> <p>Cr\u00e9er un utilisateur d\u00e9di\u00e9 :</p> <pre><code>sudo useradd -m -s /usr/bin/rssh rsshuser\nsudo passwd rsshuser\n</code></pre>"},{"location":"TP2/#tester-la-connexion-ssh","title":"Tester la connexion SSH","text":"<p>Tentative de connexion via SSH. \u00c9chec attendu d\u00fb \u00e0 une restriction SELinux.</p>"},{"location":"TP2/#diagnostiquer-le-blocage","title":"Diagnostiquer le blocage","text":"<pre><code>sudo ausearch -m AVC -ts recent\nsudo audit2why -a\n</code></pre> <p>Identifier la recommandation et v\u00e9rifier les bool\u00e9ens associ\u00e9s :</p> <pre><code>getsebool -a | grep ssh\n</code></pre>"},{"location":"TP2/#appliquer-la-modification","title":"Appliquer la modification","text":"<pre><code>sudo setsebool -P allowssh_chroot_full_access on\n</code></pre> <p>Tester \u00e0 nouveau la connexion SSH.</p>"},{"location":"TP2/#manipulation-directe-des-contextes-avec-chcon","title":"Manipulation directe des contextes avec <code>chcon</code>","text":""},{"location":"TP2/#objectif_2","title":"Objectif","text":"<p>Modifier temporairement un contexte SELinux sans toucher aux r\u00e8gles persistantes, pour un cas de test ou d\u00e9bogage.</p>"},{"location":"TP2/#etapes_2","title":"\u00c9tapes","text":""},{"location":"TP2/#creer-un-fichier-de-test","title":"Cr\u00e9er un fichier de test","text":"<pre><code>mkdir ~/testselinux\ntouch ~/testselinux/file.txt\nls -Z ~/testselinux/file.txt\n</code></pre>"},{"location":"TP2/#changer-le-contexte","title":"Changer le contexte","text":"<pre><code>sudo chcon -t httpd_sys_content_t ~/testselinux/file.txt\nls -Z ~/testselinux/file.txt\n</code></pre>"},{"location":"TP2/#lancer-un-serveur-http-local","title":"Lancer un serveur HTTP local","text":"<pre><code>python3 -m http.server --directory ~/testselinux 8080\n</code></pre> <p>Acc\u00e9der \u00e0 <code>http://localhost:8080/file.txt</code>. SELinux ne devrait pas bloquer si le contexte est correctement appliqu\u00e9.</p>"},{"location":"TP2/#reinitialiser-le-contexte","title":"R\u00e9initialiser le contexte","text":"<pre><code>sudo restorecon -v ~/testselinux/file.txt\n</code></pre> <p>V\u00e9rifier que le contexte d\u2019origine a \u00e9t\u00e9 restaur\u00e9.</p>"},{"location":"TP3/","title":"TP SELinux \u2013 Multi-Level Security (MLS) &amp; Multi-Category Security (MCS)","text":""},{"location":"TP3/#objectifs-pedagogiques","title":"Objectifs p\u00e9dagogiques","text":"<ul> <li>Comprendre les principes de MLS et MCS dans SELinux.</li> <li>Manipuler les niveaux (<code>s0</code>, <code>s1</code>, etc.) et les cat\u00e9gories (<code>c0</code>, <code>c1</code>, etc.).</li> <li>Mettre en \u0153uvre un isolement de donn\u00e9es bas\u00e9 sur les niveaux et cat\u00e9gories.</li> <li>G\u00e9rer les utilisateurs SELinux avec des plages MLS/MCS d\u00e9finies.</li> </ul>"},{"location":"TP3/#pre-requis","title":"Pr\u00e9-requis","text":"<ul> <li>SELinux activ\u00e9 en mode <code>enforcing</code>.</li> <li>Politique <code>mls</code> ou <code>targeted</code> avec MCS (selon la distribution).</li> <li>Utiliser une machine Fedora ou RHEL avec le support de MLS/MCS (ex. : <code>mls</code> activ\u00e9 via <code>/etc/selinux/config</code>).</li> <li>Avoir le paquet <code>policycoreutils</code>, <code>mcstrans</code>, <code>setools-console</code> install\u00e9.</li> </ul>"},{"location":"TP3/#contexte-du-tp","title":"Contexte du TP","text":"<p>Nous allons simuler une s\u00e9paration d\u2019informations classifi\u00e9es par niveaux (MLS) et par cat\u00e9gories (MCS). Deux utilisateurs vont avoir des droits diff\u00e9rents sur des fichiers en fonction de leur niveau ou de leur appartenance \u00e0 des cat\u00e9gories.</p>"},{"location":"TP3/#creation-dun-environnement-controle","title":"Cr\u00e9ation d\u2019un environnement contr\u00f4l\u00e9","text":""},{"location":"TP3/#creation-des-utilisateurs-linux-et-selinux","title":"Cr\u00e9ation des utilisateurs Linux et SELinux","text":"<pre><code>useradd alice\nuseradd bob\n</code></pre> <p>D\u00e9finir une plage MLS/MCS restreinte \u00e0 chaque utilisateur :</p> <pre><code>semanage user -a -R \"staff_r\" -r \"s0:c0\" mcs_alice\nsemanage user -a -R \"staff_r\" -r \"s0:c1\" mcs_bob\nsemanage login -a -s mcs_alice alice\nsemanage login -a -s mcs_bob bob\n</code></pre> <p>V\u00e9rification :</p> <pre><code>semanage login -l\n</code></pre>"},{"location":"TP3/#manipulation-de-fichiers-avec-contexte-mcs","title":"Manipulation de fichiers avec contexte MCS","text":"<p>Cr\u00e9er un fichier classifi\u00e9 pour chaque cat\u00e9gorie :</p> <pre><code>touch /tmp/data_alice /tmp/data_bob\nchcon -t user_home_t -l s0:c0 /tmp/data_alice\nchcon -t user_home_t -l s0:c1 /tmp/data_bob\n</code></pre>"},{"location":"TP3/#test-de-lecture-croisee","title":"Test de lecture crois\u00e9e","text":"<p>Connectez-vous successivement en tant que <code>alice</code> et <code>bob</code>, testez l'acc\u00e8s \u00e0 chaque fichier :</p> <pre><code>su - alice\ncat /tmp/data_alice\ncat /tmp/data_bob\n</code></pre> <p>Puis :</p> <pre><code>su - bob\ncat /tmp/data_bob\ncat /tmp/data_alice\n</code></pre> <p>Question : Que constatez-vous ? Pourquoi ?</p>"},{"location":"TP3/#changement-de-contexte-de-processus-utilisateur","title":"Changement de contexte de processus utilisateur","text":"<p>Observez les contextes SELinux avec :</p> <pre><code>id -Z\n</code></pre> <p>Puis changez temporairement le contexte MCS d\u2019un shell :</p> <pre><code>sudo runcon -l s0:c0 -- bash\n</code></pre> <p>Tentez \u00e0 nouveau la lecture de fichiers. Testez d'autres cat\u00e9gories.</p>"},{"location":"TP3/#utilisation-avancee-plages-mls","title":"Utilisation avanc\u00e9e : plages MLS","text":"<p>Modifiez l'utilisateur <code>alice</code> pour qu'il ait une plage de niveaux (ex : <code>s0 - s1</code>)</p> <pre><code>semanage user -m -R \"staff_r\" -r \"s0 - s1:c0.c3\" mcs_alice\n</code></pre> <p>Cr\u00e9ez un fichier avec un niveau sup\u00e9rieur :</p> <pre><code>chcon -t user_home_t -l s1 /tmp/data_topsecret\n</code></pre> <p>Testez l\u2019acc\u00e8s avec <code>alice</code>. Essayez de changer de niveau avec <code>runcon</code>.</p>"},{"location":"TP3/#question-bonus","title":"Question bonus","text":"<ul> <li>Que se passe-t-il si <code>alice</code> a acc\u00e8s \u00e0 plusieurs cat\u00e9gories ? Peut-elle combiner les lectures ?</li> <li>Peut-on attribuer plusieurs cat\u00e9gories \u00e0 un fichier ?</li> <li>Quel est l\u2019impact de la commande <code>mcstransd</code> dans l'affichage des contextes ?</li> </ul>"},{"location":"TP3/#nettoyage","title":"Nettoyage","text":"<pre><code>userdel -r alice\nuserdel -r bob\nsemanage login -d alice\nsemanage login -d bob\nsemanage user -d mcs_alice\nsemanage user -d mcs_bob\nrm -f /tmp/data_alice /tmp/data_bob /tmp/data_topsecret\n</code></pre>"},{"location":"TP3/#aller-plus-loin","title":"Aller plus loin","text":"<ul> <li>Cr\u00e9ez un script de v\u00e9rification automatique du niveau et des cat\u00e9gories autoris\u00e9es d\u2019un utilisateur.</li> <li>Int\u00e9grez ce m\u00e9canisme dans un environnement Podman ou systemd avec <code>selinux-label</code>.</li> </ul>"},{"location":"TP4/","title":"TP SELinux \u2013 Conteneurs Podman en rootless","text":""},{"location":"TP4/#objectifs-pedagogiques","title":"Objectifs p\u00e9dagogiques","text":"<ul> <li>Comprendre comment SELinux isole les conteneurs en mode rootless.</li> <li>Manipuler les options <code>:z</code>, <code>:Z</code>, <code>--security-opt</code> dans Podman.</li> <li>Observer les contextes des processus et volumes dans l\u2019environnement utilisateur.</li> <li>Exp\u00e9rimenter avec des politiques personnalis\u00e9es (Udica).</li> </ul>"},{"location":"TP4/#pre-requis","title":"Pr\u00e9-requis","text":"<ul> <li>Fedora ou RHEL avec Podman install\u00e9 (<code>dnf install podman udica -y</code>)</li> <li>SELinux activ\u00e9 (<code>getenforce</code> doit retourner <code>Enforcing</code>)</li> <li>Utilisateur non-root avec droits sudo</li> <li>Acc\u00e8s SSH ou TTY</li> </ul>"},{"location":"TP4/#mise-en-place-de-lenvironnement","title":"Mise en place de l\u2019environnement","text":"<p>Cr\u00e9er un utilisateur d\u00e9di\u00e9 :</p> <pre><code>sudo useradd -m podtest\nsudo passwd podtest\n</code></pre> <p>Se connecter avec ce nouvel utilisateur :</p> <pre><code>su - podtest\n</code></pre>"},{"location":"TP4/#lancer-un-conteneur-simple-rootless","title":"Lancer un conteneur simple (rootless)","text":"<pre><code>podman run --rm -d --name nginx -p 8080:80 docker.io/library/nginx\n</code></pre> <p>V\u00e9rifier que le conteneur tourne et identifier son contexte SELinux :</p> <pre><code>ps -eZ | grep nginx\n</code></pre> <p>Lister les contextes des fichiers :</p> <pre><code>ls -Z ~/.local/share/containers/\n</code></pre>"},{"location":"TP4/#test-de-montage-de-volume-sans-option-de-relabel","title":"Test de montage de volume sans option de relabel","text":"<p>Cr\u00e9er un dossier \u00e0 monter :</p> <pre><code>mkdir ~/nginx_data\n</code></pre> <p>Tenter un montage :</p> <pre><code>podman run --rm -d --name nginx-vol -v ~/nginx_data:/usr/share/nginx/html:ro -p 8081:80 nginx\n</code></pre> <p>Inspecter les logs (vous devriez avoir une erreur AVC) :</p> <pre><code>journalctl --user -b | grep AVC\n</code></pre>"},{"location":"TP4/#resolution-via-z-et-z","title":"R\u00e9solution via <code>:z</code> et <code>:Z</code>","text":"<p>Rejouer avec <code>:z</code> :</p> <pre><code>podman run --rm -d --name nginx-z -v ~/nginx_data:/usr/share/nginx/html:ro,z -p 8082:80 nginx\n</code></pre> <p>Puis avec <code>:Z</code> :</p> <pre><code>podman run --rm -d --name nginx-Z -v ~/nginx_data:/usr/share/nginx/html:ro,Z -p 8083:80 nginx\n</code></pre> <p>Comparer les contextes apr\u00e8s chaque lancement :</p> <pre><code>ls -Z ~/nginx_data\n</code></pre> <p>Questions :</p> <ul> <li>Quelle diff\u00e9rence entre <code>:z</code> et <code>:Z</code> ?</li> <li>Dans quel cas utiliser l\u2019un ou l\u2019autre ?</li> </ul>"},{"location":"TP4/#observation-du-contexte-reseau","title":"Observation du contexte r\u00e9seau","text":"<p>Lister les sockets utilis\u00e9s par les conteneurs avec :</p> <pre><code>ss -Ztulpn\n</code></pre> <p>Ou bien :</p> <pre><code>sudo ss -tulpnZ | grep 808\n</code></pre>"},{"location":"TP4/#utilisation-de-security-opt-label","title":"Utilisation de <code>--security-opt label=...</code>","text":"<p>Cr\u00e9er un conteneur avec un contexte explicite :</p> <pre><code>podman run --rm -d --name secure-nginx \\\n  --security-opt label=type:container_runtime_t \\\n  -p 8084:80 nginx\n</code></pre> <p>Inspecter :</p> <pre><code>ps -eZ | grep nginx\n</code></pre>"},{"location":"TP4/#creation-dune-politique-personnalisee-avec-udica","title":"Cr\u00e9ation d\u2019une politique personnalis\u00e9e avec Udica","text":"<p>G\u00e9n\u00e9rer le JSON de profil :</p> <pre><code>podman generate systemd --name secure-nginx &gt; podman-secure.service\n</code></pre> <p>Cr\u00e9er une politique personnalis\u00e9e :</p> <pre><code>udica secure-nginx\n</code></pre> <p>Installer le module g\u00e9n\u00e9r\u00e9 :</p> <pre><code>sudo semodule -i secure-nginx.cil\n</code></pre> <p>Relancer le conteneur avec le nouveau label :</p> <pre><code>podman run --rm -d --name nginx-udica \\\n  --security-opt label=type:secure_nginx.process \\\n  -v ~/nginx_data:/usr/share/nginx/html:ro,Z \\\n  -p 8085:80 nginx\n</code></pre> <p>V\u00e9rifier :</p> <pre><code>ps -eZ | grep nginx\n</code></pre>"},{"location":"TP4/#nettoyage","title":"Nettoyage","text":"<pre><code>podman stop -a\npodman rm -a\npodman rmi nginx\nsudo semodule -r secure-nginx\nrm -rf ~/nginx_data podman-secure.service\n</code></pre>"},{"location":"TP4/#questions-bonus","title":"Questions bonus","text":"<ul> <li>Pourquoi <code>:Z</code> est risqu\u00e9 \u00e0 utiliser sur des fichiers partag\u00e9s ?</li> <li>Peut-on utiliser <code>Udica</code> avec Docker ?</li> <li>Que permet de faire <code>--security-opt label=disable</code> et dans quels cas est-ce utile ?</li> </ul>"}]}